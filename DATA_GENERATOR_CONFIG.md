# LS-Game-NTG-Data 数据生成器配置说明

## 概述

**程序**: LS-Game-DataGen v2.0
**策略**: 产能驱动生成（Capacity-Driven Generation）
**保证**: 生成的算例必然可行
**位置**: D:\LS-Game-NTG-Data\

---

## 当前预设配置（S1规模）

### 一、基本规模参数

| 参数 | 符号 | 预设值 | 说明 | 配置位置 |
|------|------|--------|------|---------|
| 节点数量 | U | 6 | 供应链网络中的工厂/节点数 | main.cpp:57 |
| 产品种类 | N | 20 | 不同产品的数量 | main.cpp:61 |
| 产品族数 | G | 2 | 产品分组数（共享setup）| main.cpp:66 |
| 计划周期 | T | 15 | 计划时间段数 | main.cpp:71 |
| 启用转运 | - | true | 是否允许节点间转运 | main.cpp:76 |

**规模调整说明**:
- S1规模：适配60秒求解时间限制
- 从Week 2的 6×30×20 调整为 6×20×15
- 问题复杂度降低约45%

---

### 二、产能参数

| 参数 | 预设值 | 单位 | 说明 | 配置位置 |
|------|--------|------|------|---------|
| 默认产能 | 1440.0 | 分钟/周期 | 每个节点每周期可用时间 | main.cpp:84 |
| 生产时间 | 1.0 | 分钟/件 | 生产1件产品所需时间 | main.cpp:88 |
| 启动时间 | 10.0 | 分钟/次 | 启动生产一个产品族的准备时间 | main.cpp:92 |

**产能解释**:
- 1440分钟 = 24小时 × 60分钟（一天的总时间）
- 理论最大产量 = 1440分钟 / 1分钟 = 1440件/周期
- 实际产量 < 1440件（需扣除启动时间）

---

### 三、需求生成参数（核心）

#### 3.1 规模控制参数

| 参数 | 预设值 | 范围 | 说明 | 影响 |
|------|--------|------|------|------|
| 产能利用率 | 85% | 70%-90% | 目标产能使用率 | 控制总需求量 |
| 需求密度 | 15% | 10%-30% | 有需求的(u,i,t)组合比例 | 控制需求点数 |
| 初始库存比例 | 0% | 0%-30% | 初始库存占平均需求的比例 | 初始条件 |

**实际生成结果**（从日志）:
```
目标利用率: 85%
实际利用率: 72% (因需求离散化)
需求点数: 270个 (理论最大: 6×20×15 = 1800)
总需求量: 93402件
平均需求: 346件/点
```

**需求密度计算**:
```
需求密度 = 270 / 1800 = 15% ✓
实际密度与目标一致
```

#### 3.2 分布控制参数

| 参数 | 预设值 | 范围 | 说明 | 效果 |
|------|--------|------|------|------|
| 时间集中度 | 0.2 | 0.1-0.3 | 需求在时间维度的集中程度 | 0.2 = 轻度集中 |
| 节点集中度 | 0.3 | 0.2-0.4 | 需求在节点维度的集中程度 | 0.3 = 中度集中 |
| 产品集中度 | 0.3 | 0.2-0.4 | 需求在产品维度的集中程度 | 0.3 = 中度集中 |
| 需求量方差 | 0.3 | 0.2-0.5 | 需求量的离散程度 | 0.3 = 中等变化 |

**集中度解释**:
- 0.0 = 完全均匀分布
- 0.5 = 中度集中
- 1.0 = 高度集中于少数元素

**当前配置效果**:
- 时间: 轻度集中（20%），需求分布相对平稳
- 节点: 中度集中（30%），部分节点需求更多
- 产品: 中度集中（30%），部分产品需求更多

---

### 四、成本参数

#### 4.1 成本配置模式

| 参数 | 预设值 | 说明 |
|------|--------|------|
| 使用变化成本 | true | 每个产品有不同的成本 |
| 生产成本 (cX) | 1.0 | 统一的单位生产成本 |
| 启动成本 (cY) | 1.0 | 按产品族的启动成本 |
| 库存成本 (cI) | 1.0 | 按产品的持有成本 |

**成本范围**（当前配置）:
```cpp
cY范围: [1.0, 1.0]  // 统一值
cI范围: [1.0, 1.0]  // 统一值
```

**注意**: 虽然 `use_varied_costs = true`，但当前min和max相同，实际上使用统一成本。

#### 4.2 转运成本（仅当启用转运时）

| 参数 | 预设值 | 说明 |
|------|--------|------|
| 基础转运成本 | 5.0 | 单位产品从u转运到v的成本 |
| BigM值 | 自动计算 | 总需求量的2倍（最小10000）|

**转运数据量**:
```
转运成本条目: U×(U-1)×N×T = 6×5×20×15 = 9,000条
BigM条目: N×T = 20×15 = 300条
```

**实际BigM值**: 186,804（约为总需求93,402的2倍）

---

### 五、随机种子

| 参数 | 预设值 | 说明 |
|------|--------|------|
| 需求种子 | 42 | 固定种子，确保可重复性 |

**重要**: 当前所有算例使用**相同的随机种子**，导致生成的需求数据完全相同！

**问题**（已在Week 3报告中指出）:
- 所有5个测试实例的需求数据完全一致
- 总需求量都是 93,402
- 无法进行统计分析

**建议修复** (main.cpp:167):
```cpp
// 修改前
unsigned int demand_seed = 42;

// 修改为基于时间的种子
auto now = std::chrono::system_clock::now();
unsigned int demand_seed = now.time_since_epoch().count() % 100000;
std::cout << "Random seed: " << demand_seed << std::endl;
```

---

## 生成的算例数据结构

### CSV文件格式

**输出位置**: `D:\LS-Game-NTG-Data\output\case_YYYYMMDD_HHMMSS.csv`

**文件大小**: 约229 KB

**主要数据块**:

| 数据类型 | 格式 | 数量 | 说明 |
|---------|------|------|------|
| 规模参数 | `param,name,value` | ~10行 | U, N, G, T等 |
| 产能数据 | `capacity,u,t,value` | 90行 | 6×15=90 |
| 需求数据 | `demand,u,i,t,amount` | 270行 | 实际需求点 |
| 成本参数 | `cost,type,index,value` | ~50行 | cX, cY, cI |
| 转运成本 | `transfer,cT,u,v,i,t,cost` | 9,000行 | U×(U-1)×N×T |
| BigM数据 | `bigM,M,,,i,t,value` | 300行 | N×T |
| 求解配置 | `solver,param,value` | ~5行 | 求解器参数 |

**总行数**: 约9,700-10,000行

---

## 生成的算例特征

### 实际生成结果分析（基于日志）

#### 需求分布

```
总需求点数: 270个
  理论最大: U×N×T = 6×20×15 = 1,800个
  需求密度: 270/1800 = 15% ✓

总需求量: 93,402件
  平均每点: 346件
  标准差: ~104件（估计，基于variance=0.3）

需求范围（估计）:
  最小需求: ~200件
  最大需求: ~500件
```

#### 产能使用

```
总可用产能: U×T×1440 = 6×15×1440 = 129,600分钟

实际使用（生产）:
  生产时间: 93,402 × 1 = 93,402分钟
  启动时间: 估计270×10 = 2,700分钟（假设每个需求点需要启动）
  总使用: ~96,102分钟

实际利用率: 96,102 / 129,600 = 74.2%
  与日志记录的72%接近 ✓
```

#### 节点需求分布（估计）

由于节点集中度=0.3，需求分布不均：

| 节点 | 预期需求占比 | 预期需求量 |
|------|-------------|-----------|
| 高需求节点 | 20-25% | 18,680-23,350 |
| 中需求节点 | 15-18% | 14,010-16,812 |
| 低需求节点 | 10-12% | 9,340-11,208 |

#### 时间分布（估计）

由于时间集中度=0.2（较低），需求相对平稳：

```
高峰周期（2-3个）: 需求量约7,000-8,000件/周期
平均周期（大部分）: 需求量约6,000-6,500件/周期
低谷周期（2-3个）: 需求量约4,000-5,000件/周期
```

---

## 如何使用数据生成器

### 方式1: 使用当前配置生成

```bash
cd D:\LS-Game-NTG-Data
.\build\release\bin\Release\LSGameDataGen.exe
```

**输出**:
- CSV算例: `output/case_YYYYMMDD_HHMMSS.csv`
- 日志文件: `output/log_YYYYMMDD_HHMMSS.txt`

### 方式2: 修改配置后生成

1. **编辑配置** (`src/main.cpp`)
2. **重新编译**:
   ```bash
   cmake --preset vs2022-release
   cmake --build --preset build-release
   ```
3. **运行生成器**:
   ```bash
   .\build\release\bin\Release\LSGameDataGen.exe
   ```

### 常用配置调整

#### 调整1: 增加规模（更大算例）

```cpp
int U = 10;     // 节点数: 6 → 10
int N = 30;     // 产品数: 20 → 30
int T = 20;     // 周期数: 15 → 20
```

**影响**:
- 变量数增加约4倍
- 求解时间可能增加10倍以上

#### 调整2: 降低利用率（更宽松）

```cpp
double capacity_utilization = 0.70;  // 85% → 70%
```

**影响**:
- 需求量减少约18%
- 求解更容易找到可行解

#### 调整3: 增加需求密度（更多需求点）

```cpp
double demand_intensity = 0.25;  // 15% → 25%
```

**影响**:
- 需求点增加约67%
- 问题更复杂，求解时间增加

#### 调整4: 禁用转运（简化问题）

```cpp
bool enable_transfer = false;  // true → false
```

**影响**:
- 变量数减少83%（从37,800减至5,400）
- 求解时间减少约90%

#### 调整5: 使用随机种子（生成不同数据）

```cpp
// 基于时间的随机种子
auto now = std::chrono::system_clock::now();
unsigned int demand_seed = now.time_since_epoch().count() % 100000;
```

**影响**:
- 每次生成不同的需求数据
- 可用于统计分析

---

## 数据文件示例

### 生成的CSV文件结构示例

```csv
param,U,,,,6
param,I,,,,20
param,G,,,,2
param,T,,,,15
param,enable_transfer,,,,1

capacity,0,0,,,1440.000000
capacity,0,1,,,1440.000000
...

demand,0,3,5,,412.500000
demand,0,7,8,,356.200000
demand,1,2,4,,389.100000
...

cost,cX,0,,,1.000000
cost,cX,1,,,1.000000
...

cost,cY,0,,,1.000000
cost,cY,1,,,1.000000

cost,cI,0,,,1.000000
...

transfer,cT,0,1,0,0,5.000000
transfer,cT,0,1,0,1,5.000000
...

bigM,M,,,0,0,186804.216586
bigM,M,,,0,1,186804.216586
...

solver,mip_gap,,,,,1e-4
solver,time_limit_sec,,,,,3600
solver,threads,,,,,20
solver,sep_violation_eps,,,,,1e-6
solver,max_iters,,,,,200
```

---

## 推荐配置方案

### 方案1: 快速测试（建议初学者）

```cpp
int U = 3;
int N = 10;
int T = 10;
bool enable_transfer = false;
double capacity_utilization = 0.70;
double demand_intensity = 0.20;
```

**特点**:
- 变量数: ~900
- 求解时间: <10秒
- 适合：算法开发和调试

### 方案2: 中等规模（当前S1配置）

```cpp
int U = 6;
int N = 20;
int T = 15;
bool enable_transfer = true;
double capacity_utilization = 0.85;
double demand_intensity = 0.15;
```

**特点**:
- 变量数: ~37,800
- 求解时间: 2-4秒（实际测试）
- 适合：会议论文实验

### 方案3: 大规模挑战

```cpp
int U = 10;
int N = 30;
int T = 20;
bool enable_transfer = false;  // 建议禁用转运
double capacity_utilization = 0.80;
double demand_intensity = 0.15;
```

**特点**:
- 变量数: ~18,000（不含转运）
- 求解时间: 30-120秒（估计）
- 适合：算法性能测试

---

## 故障排查

### Q1: 生成的需求数据全部相同？

**原因**: 使用固定随机种子（42）

**解决**: 修改 `main.cpp:167`，使用时间作为种子

### Q2: 生成的算例无可行解？

**原因**: 产能不足或参数配置不当

**检查**:
1. 产能利用率是否<95%
2. 需求密度是否合理
3. 查看日志中的实际利用率

**解决**: 降低 `capacity_utilization` 或增加 `default_capacity`

### Q3: CSV文件太大？

**原因**: 启用转运导致9000+行数据

**解决**: 设置 `enable_transfer = false` 或减小规模

### Q4: 生成速度慢？

**原因**: 规模过大

**检查**: 转运条目数 = U×(U-1)×N×T

**解决**: 减小 U, N, 或 T

---

## 文件清单

### 源代码

```
src/
├── main.cpp              - 主程序和配置
├── case_generator.h/cpp  - CSV生成器
├── demand_generator.h/cpp- 需求生成器
├── csv_writer.h/cpp      - CSV写入器
└── logger.h              - 日志工具
```

### 输出文件

```
output/
├── case_YYYYMMDD_HHMMSS.csv  - 算例数据
├── log_YYYYMMDD_HHMMSS.txt   - 生成日志
└── *_report.json             - 可能的测试报告（非正式输出）
```

### 文档

```
TRANSFER_FEATURE.md       - 转运功能说明
DATA_GENERATOR_CONFIG.md  - 本文档
```

---

## 总结

**当前S1规模配置**:
- 6玩家 × 20产品 × 15周期
- 启用转运
- 85%产能利用率目标
- 15%需求密度
- 生成270个需求点
- 总需求约93,400件
- CSV文件229KB

**主要特点**:
- 产能驱动生成，保证可行性
- 适配60秒求解时间限制
- 支持转运和非转运模式
- 高度可配置

**建议改进**:
1. 使用随机种子生成不同数据
2. 根据实验需求调整规模
3. 考虑禁用转运以加快求解

---

**文档版本**: 1.0
**最后更新**: 2025-10-24
**基于版本**: LS-Game-DataGen v2.0
